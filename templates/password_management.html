<<<<<<< HEAD
{% extends "base.html" %}

{% block title %}Quản lý mật khẩu - Hệ thống Quản lý Phiếu Kỹ thuật{% endblock %}

{% block content %}
<div class="card">
    <h1 style="margin-bottom: 2rem; color: #667eea;">
        <i class="fas fa-key"></i> Quản lý mật khẩu
    </h1>
    
    <!-- Thông báo -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'thanh_cong' else 'danger' if category == 'loi' else 'info' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <!-- Tìm kiếm user -->
    <div class="search-section" style="margin-bottom: 2rem;">
        <form method="GET" action="{{ url_for('password_management') }}" class="search-form">
            <div class="input-group">
                <input type="text" name="search" class="form-control" 
                       placeholder="Tìm kiếm theo tên đăng nhập hoặc email..." 
                       value="{{ request.args.get('search', '') }}">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Tìm kiếm
                </button>
            </div>
        </form>
    </div>
    
    <!-- Danh sách users -->
    <div class="users-list">
        {% if users %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên đăng nhập</th>
                            <th>Email</th>
                            <th>Vai trò</th>
                            <th>Trạng thái</th>
                            <th>Ngày tạo</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td><strong>{{ user.username }}</strong></td>
                            <td>{{ user.email }}</td>
                            <td>
                                <span class="badge badge-role-{{ user.role }}">
                                    {% if user.role == 'quan_tri_vien' %}Quản trị viên
                                    {% elif user.role == 'quan_ly' %}Quản lý
                                    {% elif user.role == 'kinh_doanh' %}Kinh doanh
                                    {% else %}Kỹ thuật viên{% endif %}
                                </span>
                            </td>
                            <td>
                                {% if user.is_online %}
                                    <span class="badge badge-success">
                                        <i class="fas fa-circle"></i> Online
                                    </span>
                                {% else %}
                                    <span class="badge badge-secondary">
                                        <i class="fas fa-circle"></i> Offline
                                    </span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-warning reset-password-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-key"></i> Đặt lại
                                    </button>
                                    <button type="button" class="btn btn-sm btn-info change-password-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-edit"></i> Thay đổi
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger force-logout-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-sign-out-alt"></i> Đăng xuất
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> Không tìm thấy tài khoản nào.
            </div>
        {% endif %}
    </div>
    
    <!-- Nút quay lại -->
    <div style="text-align: right; margin-top: 2rem;">
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay lại quản lý nhân viên
        </a>
    </div>
</div>

<!-- Modal đặt lại mật khẩu -->
<div id="resetPasswordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> Đặt lại mật khẩu</h3>
            <span class="close" onclick="closeModal('resetPasswordModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('reset_user_password') }}">
            <div class="modal-body">
                <input type="hidden" id="reset_user_id" name="user_id">
                <p>Bạn sắp đặt lại mật khẩu cho tài khoản: <strong id="reset_username"></strong></p>
                <p>Mật khẩu mới sẽ được tạo tự động và hiển thị bên dưới.</p>
                
                <div class="form-group">
                    <label for="new_password" class="form-label">Mật khẩu mới:</label>
                    <div class="input-group">
                        <input type="text" id="new_password" name="new_password" class="form-control" readonly>
                        <button type="button" class="btn btn-secondary" onclick="generatePassword()">
                            <i class="fas fa-sync"></i> Tạo mới
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="copyPassword()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Độ mạnh mật khẩu:</label>
                    <div id="password_strength" class="password-strength">
                        <div class="strength-bar"></div>
                        <span class="strength-text">Chưa tạo</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('resetPasswordModal')">Hủy</button>
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-key"></i> Đặt lại mật khẩu
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal thay đổi mật khẩu -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Thay đổi mật khẩu</h3>
            <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('change_user_password') }}">
            <div class="modal-body">
                <input type="hidden" id="change_user_id" name="user_id">
                <p>Thay đổi mật khẩu cho tài khoản: <strong id="change_username"></strong></p>
                
                <div class="form-group">
                    <label for="current_password" class="form-label">Mật khẩu hiện tại:</label>
                    <input type="password" id="current_password" name="current_password" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="new_password_change" class="form-label">Mật khẩu mới:</label>
                    <input type="password" id="new_password_change" name="new_password" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password" class="form-label">Xác nhận mật khẩu mới:</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Hủy</button>
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-save"></i> Lưu thay đổi
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal đăng xuất cưỡng bức -->
<div id="forceLogoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-sign-out-alt"></i> Đăng xuất cưỡng bức</h3>
            <span class="close" onclick="closeModal('forceLogoutModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('force_logout_user') }}">
            <div class="modal-body">
                <input type="hidden" id="logout_user_id" name="user_id">
                <p>Bạn sắp đăng xuất cưỡng bức tài khoản: <strong id="logout_username"></strong></p>
                <p><strong>Lưu ý:</strong> Người dùng sẽ bị đăng xuất khỏi tất cả thiết bị đang sử dụng.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('forceLogoutModal')">Hủy</button>
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất cưỡng bức
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.badge-role-quan_tri_vien { background-color: #dc3545; }
.badge-role-quan_ly { background-color: #fd7e14; }
.badge-role-kinh_doanh { background-color: #20c997; }
.badge-role-ky_thuat_vien { background-color: #6f42c1; }

.password-strength {
    display: flex;
    align-items: center;
    gap: 10px;
}

.strength-bar {
    flex: 1;
    height: 8px;
    background-color: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.strength-bar::before {
    content: '';
    display: block;
    height: 100%;
    width: 0%;
    transition: all 0.3s;
}

.strength-bar.weak::before { background-color: #dc3545; width: 25%; }
.strength-bar.fair::before { background-color: #ffc107; width: 50%; }
.strength-bar.good::before { background-color: #17a2b8; width: 75%; }
.strength-bar.strong::before { background-color: #28a745; width: 100%; }

.strength-text {
    font-size: 12px;
    font-weight: bold;
}

.input-group {
    display: flex;
    gap: 5px;
}

.input-group .form-control {
    flex: 1;
}

.btn-group {
    display: flex;
    gap: 5px;
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}
</style>

<script>
// Hiển thị modal đặt lại mật khẩu
function showResetPasswordModal(userId, username) {
    document.getElementById('reset_user_id').value = userId;
    document.getElementById('reset_username').textContent = username;
    document.getElementById('resetPasswordModal').style.display = 'block';
    generatePassword();
}

// Hiển thị modal thay đổi mật khẩu
function showChangePasswordModal(userId, username) {
    document.getElementById('change_user_id').value = userId;
    document.getElementById('change_username').textContent = username;
    document.getElementById('changePasswordModal').style.display = 'block';
}

// Hiển thị modal đăng xuất cưỡng bức
function showForceLogoutModal(userId, username) {
    document.getElementById('logout_user_id').value = userId;
    document.getElementById('logout_username').textContent = username;
    document.getElementById('forceLogoutModal').style.display = 'block';
}

// Thêm event listeners khi trang được load
document.addEventListener('DOMContentLoaded', function() {
    // Event listeners cho nút đặt lại mật khẩu
    document.querySelectorAll('.reset-password-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showResetPasswordModal(userId, username);
        });
    });
    
    // Event listeners cho nút thay đổi mật khẩu
    document.querySelectorAll('.change-password-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showChangePasswordModal(userId, username);
        });
    });
    
    // Event listeners cho nút đăng xuất cưỡng bức
    document.querySelectorAll('.force-logout-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showForceLogoutModal(userId, username);
        });
    });
});

// Đóng modal
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Tạo mật khẩu ngẫu nhiên
function generatePassword() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let password = '';
    for (let i = 0; i < 12; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('new_password').value = password;
    checkPasswordStrength(password);
}

// Copy mật khẩu
function copyPassword() {
    const password = document.getElementById('new_password').value;
    navigator.clipboard.writeText(password).then(() => {
        alert('Đã copy mật khẩu vào clipboard!');
    });
}

// Kiểm tra độ mạnh mật khẩu
function checkPasswordStrength(password) {
    const strengthBar = document.querySelector('.strength-bar');
    const strengthText = document.querySelector('.strength-text');
    
    let score = 0;
    if (password.length >= 8) score++;
    if (/[a-z]/.test(password)) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[0-9]/.test(password)) score++;
    if (/[^A-Za-z0-9]/.test(password)) score++;
    
    strengthBar.className = 'strength-bar';
    if (score <= 2) {
        strengthBar.classList.add('weak');
        strengthText.textContent = 'Yếu';
    } else if (score <= 3) {
        strengthBar.classList.add('fair');
        strengthText.textContent = 'Trung bình';
    } else if (score <= 4) {
        strengthBar.classList.add('good');
        strengthText.textContent = 'Tốt';
    } else {
        strengthBar.classList.add('strong');
        strengthText.textContent = 'Mạnh';
    }
}

// Đóng modal khi click bên ngoài
window.onclick = function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
=======
{% extends "base.html" %}

{% block title %}Quản lý mật khẩu - Hệ thống Quản lý Phiếu Kỹ thuật{% endblock %}

{% block content %}
<div class="card">
    <h1 style="margin-bottom: 2rem; color: #667eea;">
        <i class="fas fa-key"></i> Quản lý mật khẩu
    </h1>
    
    <!-- Thông báo -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'thanh_cong' else 'danger' if category == 'loi' else 'info' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <!-- Tìm kiếm user -->
    <div class="search-section" style="margin-bottom: 2rem;">
        <form method="GET" action="{{ url_for('password_management') }}" class="search-form">
            <div class="input-group">
                <input type="text" name="search" class="form-control" 
                       placeholder="Tìm kiếm theo tên đăng nhập hoặc email..." 
                       value="{{ request.args.get('search', '') }}">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Tìm kiếm
                </button>
            </div>
        </form>
    </div>
    
    <!-- Danh sách users -->
    <div class="users-list">
        {% if users %}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên đăng nhập</th>
                            <th>Email</th>
                            <th>Vai trò</th>
                            <th>Trạng thái</th>
                            <th>Ngày tạo</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td><strong>{{ user.username }}</strong></td>
                            <td>{{ user.email }}</td>
                            <td>
                                <span class="badge badge-role-{{ user.role }}">
                                    {% if user.role == 'quan_tri_vien' %}Quản trị viên
                                    {% elif user.role == 'quan_ly' %}Quản lý
                                    {% elif user.role == 'kinh_doanh' %}Kinh doanh
                                    {% else %}Kỹ thuật viên{% endif %}
                                </span>
                            </td>
                            <td>
                                {% if user.is_online %}
                                    <span class="badge badge-success">
                                        <i class="fas fa-circle"></i> Online
                                    </span>
                                {% else %}
                                    <span class="badge badge-secondary">
                                        <i class="fas fa-circle"></i> Offline
                                    </span>
                                {% endif %}
                            </td>
                            <td>{{ user.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-warning reset-password-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-key"></i> Đặt lại
                                    </button>
                                    <button type="button" class="btn btn-sm btn-info change-password-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-edit"></i> Thay đổi
                                    </button>
                                    <button type="button" class="btn btn-sm btn-danger force-logout-btn" 
                                            data-user-id="{{ user.id }}" data-username="{{ user.username }}">
                                        <i class="fas fa-sign-out-alt"></i> Đăng xuất
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> Không tìm thấy tài khoản nào.
            </div>
        {% endif %}
    </div>
    
    <!-- Nút quay lại -->
    <div style="text-align: right; margin-top: 2rem;">
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Quay lại quản lý nhân viên
        </a>
    </div>
</div>

<!-- Modal đặt lại mật khẩu -->
<div id="resetPasswordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> Đặt lại mật khẩu</h3>
            <span class="close" onclick="closeModal('resetPasswordModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('reset_user_password') }}">
            <div class="modal-body">
                <input type="hidden" id="reset_user_id" name="user_id">
                <p>Bạn sắp đặt lại mật khẩu cho tài khoản: <strong id="reset_username"></strong></p>
                <p>Mật khẩu mới sẽ được tạo tự động và hiển thị bên dưới.</p>
                
                <div class="form-group">
                    <label for="new_password" class="form-label">Mật khẩu mới:</label>
                    <div class="input-group">
                        <input type="text" id="new_password" name="new_password" class="form-control" readonly>
                        <button type="button" class="btn btn-secondary" onclick="generatePassword()">
                            <i class="fas fa-sync"></i> Tạo mới
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="copyPassword()">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Độ mạnh mật khẩu:</label>
                    <div id="password_strength" class="password-strength">
                        <div class="strength-bar"></div>
                        <span class="strength-text">Chưa tạo</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('resetPasswordModal')">Hủy</button>
                <button type="submit" class="btn btn-warning">
                    <i class="fas fa-key"></i> Đặt lại mật khẩu
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal thay đổi mật khẩu -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Thay đổi mật khẩu</h3>
            <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('change_user_password') }}">
            <div class="modal-body">
                <input type="hidden" id="change_user_id" name="user_id">
                <p>Thay đổi mật khẩu cho tài khoản: <strong id="change_username"></strong></p>
                
                <div class="form-group">
                    <label for="current_password" class="form-label">Mật khẩu hiện tại:</label>
                    <input type="password" id="current_password" name="current_password" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="new_password_change" class="form-label">Mật khẩu mới:</label>
                    <input type="password" id="new_password_change" name="new_password" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password" class="form-label">Xác nhận mật khẩu mới:</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Hủy</button>
                <button type="submit" class="btn btn-info">
                    <i class="fas fa-save"></i> Lưu thay đổi
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal đăng xuất cưỡng bức -->
<div id="forceLogoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-sign-out-alt"></i> Đăng xuất cưỡng bức</h3>
            <span class="close" onclick="closeModal('forceLogoutModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('force_logout_user') }}">
            <div class="modal-body">
                <input type="hidden" id="logout_user_id" name="user_id">
                <p>Bạn sắp đăng xuất cưỡng bức tài khoản: <strong id="logout_username"></strong></p>
                <p><strong>Lưu ý:</strong> Người dùng sẽ bị đăng xuất khỏi tất cả thiết bị đang sử dụng.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('forceLogoutModal')">Hủy</button>
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Đăng xuất cưỡng bức
                </button>
            </div>
        </form>
    </div>
</div>

<style>
.badge-role-quan_tri_vien { background-color: #dc3545; }
.badge-role-quan_ly { background-color: #fd7e14; }
.badge-role-kinh_doanh { background-color: #20c997; }
.badge-role-ky_thuat_vien { background-color: #6f42c1; }

.password-strength {
    display: flex;
    align-items: center;
    gap: 10px;
}

.strength-bar {
    flex: 1;
    height: 8px;
    background-color: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.strength-bar::before {
    content: '';
    display: block;
    height: 100%;
    width: 0%;
    transition: all 0.3s;
}

.strength-bar.weak::before { background-color: #dc3545; width: 25%; }
.strength-bar.fair::before { background-color: #ffc107; width: 50%; }
.strength-bar.good::before { background-color: #17a2b8; width: 75%; }
.strength-bar.strong::before { background-color: #28a745; width: 100%; }

.strength-text {
    font-size: 12px;
    font-weight: bold;
}

.input-group {
    display: flex;
    gap: 5px;
}

.input-group .form-control {
    flex: 1;
}

.btn-group {
    display: flex;
    gap: 5px;
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}
</style>

<script>
// Hiển thị modal đặt lại mật khẩu
function showResetPasswordModal(userId, username) {
    document.getElementById('reset_user_id').value = userId;
    document.getElementById('reset_username').textContent = username;
    document.getElementById('resetPasswordModal').style.display = 'block';
    generatePassword();
}

// Hiển thị modal thay đổi mật khẩu
function showChangePasswordModal(userId, username) {
    document.getElementById('change_user_id').value = userId;
    document.getElementById('change_username').textContent = username;
    document.getElementById('changePasswordModal').style.display = 'block';
}

// Hiển thị modal đăng xuất cưỡng bức
function showForceLogoutModal(userId, username) {
    document.getElementById('logout_user_id').value = userId;
    document.getElementById('logout_username').textContent = username;
    document.getElementById('forceLogoutModal').style.display = 'block';
}

// Thêm event listeners khi trang được load
document.addEventListener('DOMContentLoaded', function() {
    // Event listeners cho nút đặt lại mật khẩu
    document.querySelectorAll('.reset-password-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showResetPasswordModal(userId, username);
        });
    });
    
    // Event listeners cho nút thay đổi mật khẩu
    document.querySelectorAll('.change-password-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showChangePasswordModal(userId, username);
        });
    });
    
    // Event listeners cho nút đăng xuất cưỡng bức
    document.querySelectorAll('.force-logout-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const userId = this.getAttribute('data-user-id');
            const username = this.getAttribute('data-username');
            showForceLogoutModal(userId, username);
        });
    });
});

// Đóng modal
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// Tạo mật khẩu ngẫu nhiên
function generatePassword() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let password = '';
    for (let i = 0; i < 12; i++) {
        password += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('new_password').value = password;
    checkPasswordStrength(password);
}

// Copy mật khẩu
function copyPassword() {
    const password = document.getElementById('new_password').value;
    navigator.clipboard.writeText(password).then(() => {
        alert('Đã copy mật khẩu vào clipboard!');
    });
}

// Kiểm tra độ mạnh mật khẩu
function checkPasswordStrength(password) {
    const strengthBar = document.querySelector('.strength-bar');
    const strengthText = document.querySelector('.strength-text');
    
    let score = 0;
    if (password.length >= 8) score++;
    if (/[a-z]/.test(password)) score++;
    if (/[A-Z]/.test(password)) score++;
    if (/[0-9]/.test(password)) score++;
    if (/[^A-Za-z0-9]/.test(password)) score++;
    
    strengthBar.className = 'strength-bar';
    if (score <= 2) {
        strengthBar.classList.add('weak');
        strengthText.textContent = 'Yếu';
    } else if (score <= 3) {
        strengthBar.classList.add('fair');
        strengthText.textContent = 'Trung bình';
    } else if (score <= 4) {
        strengthBar.classList.add('good');
        strengthText.textContent = 'Tốt';
    } else {
        strengthBar.classList.add('strong');
        strengthText.textContent = 'Mạnh';
    }
}

// Đóng modal khi click bên ngoài
window.onclick = function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    });
}
</script>
{% endblock %}
>>>>>>> cad4acc09904766658dc682f1d2e0e72db707bbf
