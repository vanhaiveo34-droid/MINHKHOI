{% extends "base.html" %}

{% block title %}Chỉnh sửa phiếu - Hệ thống Quản lý Phiếu Kỹ thuật{% endblock %}

{% block content %}
<div class="card">
    <h1 style="margin-bottom: 2rem; color: #667eea;">
        <i class="fas fa-edit"></i> Chỉnh sửa phiếu {{ ticket.ticket_number }}
    </h1>
    
    <form method="POST" action="{{ url_for('edit_ticket', ticket_id=ticket.id) }}">
        <div class="grid grid-2">
            <div class="form-group">
                <label for="customer_name" class="form-label">
                    <i class="fas fa-building"></i> Tên công ty *
                </label>
                <input type="text" id="customer_name" name="customer_name" class="form-control" 
                       value="{{ ticket.customer_name }}" required>
            </div>
            
            <div class="form-group">
                <label for="customer_phone" class="form-label">
                    <i class="fas fa-phone"></i> Số điện thoại *
                </label>
                <input type="tel" id="customer_phone" name="customer_phone" class="form-control" 
                       value="{{ ticket.customer_phone }}" required>
            </div>
        </div>
        
        <div class="form-group">
            <label for="customer_address" class="form-label">
                <i class="fas fa-map-marker-alt"></i> Địa chỉ công ty *
            </label>
            <textarea id="customer_address" name="customer_address" class="form-control" rows="3" required>{{ ticket.customer_address }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="customer_location" class="form-label">
                <i class="fas fa-location-arrow"></i> Định vị công ty (tọa độ GPS)
            </label>
            <input type="text" id="customer_location" name="customer_location" class="form-control" 
                   value="{{ ticket.customer_location or '' }}" 
                   placeholder="Ví dụ: 10.7769, 106.7009">
            <small class="form-text text-muted">Nhập tọa độ GPS hoặc để trống</small>
        </div>
        
        <div class="form-group">
            <label for="description" class="form-label">
                <i class="fas fa-clipboard-list"></i> Mô tả công việc *
            </label>
            <textarea id="description" name="description" class="form-control" rows="4" required>{{ ticket.description }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="priority" class="form-label">
                <i class="fas fa-exclamation-triangle"></i> Độ ưu tiên
            </label>
            <select id="priority" name="priority" class="form-select">
                <option value="thap" {% if ticket.priority == 'thap' %}selected{% endif %}>Thấp</option>
                <option value="trung_binh" {% if ticket.priority == 'trung_binh' %}selected{% endif %}>Trung bình</option>
                <option value="cao" {% if ticket.priority == 'cao' %}selected{% endif %}>Cao</option>
                <option value="khan_cap" {% if ticket.priority == 'khan_cap' %}selected{% endif %}>Khẩn cấp</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-calendar"></i> Ngày tạo phiếu
            </label>
            <input type="text" class="form-control" value="{{ ticket.created_at.strftime('%d/%m/%Y %H:%M') }}" readonly>
        </div>
        
        <div style="text-align: right; margin-top: 2rem;">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Xác nhận chỉnh sửa
            </button>
        </div>
    </form>
</div>

<script>
// Auto-format phone number
document.getElementById('customer_phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 0) {
        if (value.length <= 3) {
            value = value;
        } else if (value.length <= 6) {
            value = value.slice(0, 3) + ' ' + value.slice(3);
        } else if (value.length <= 10) {
            value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6);
        } else {
            value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6, 8) + ' ' + value.slice(8, 10);
        }
    }
    e.target.value = value;
});
</script>
{% endblock %}
